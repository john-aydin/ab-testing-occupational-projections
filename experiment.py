# -*- coding: utf-8 -*-
"""Run-analyze-and-write-up-your-experiment-results.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1jSiNn-4qo1bEJ1vp8wW-hhQY2MbxJH9I

**Welcome to my experiment on the Long-term Occupational Projections in New York dataset!** 

Specifically, we will be testing the following proposition:

**Hypothesis**: *On average, will there be a statistically significant difference between the rates at which the job openings for actuaries and psychiatrists grow over the years of 2018-2028?* 

Our prediction for this project is as follows: *Those for actuaries likely will grow at a greater rate than those for psychiatrists.* 

Thank you for taking the time to view this data with me - now prepare to follow along!
"""

# Commented out IPython magic to ensure Python compatibility.
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import scipy.stats as stats
# %matplotlib inline

# Set up the data to be analyzed and take a first glance at its details:

dataset = pd.read_csv("https://data.ny.gov/api/views/pqm4-9qqb/rows.csv?accessType=DOWNLOAD")
dataset.info()
dataset.head(15)

"""**Splitting the data**: Before we begin testing our hypotheses using various techniques for data visualization and statistical computation, we are going to organize the data into the two different subsets that we wish to compare. 

Specifically, this includes a focus on a couple distinct values in the Occupation Title column: Actuaries and Psychiatrists.
"""

#dataset['Occupation Title'].unique()

dataset_act = dataset[dataset['Occupation Title'] == 'Actuaries']
print(dataset_act.head())

dataset_psy = dataset[dataset['Occupation Title'] == 'Psychiatrists']
print(dataset_psy.head())

"""**Method #1**: T-test

*First, we will search for a statistically significant difference between the percentages of growth in long-term career openings for the two sample populations being analyzed by performing a T-test.*
"""

plt.hist(dataset_act['Percent'], alpha = 0.5, label = 'Actuaries')
plt.hist(dataset_psy['Percent'], alpha = 0.5, label = 'Psychiatrists')
plt.legend(loc = 'upper left')
plt.title('Percentage of Career Growth by Region of NY')
plt.show()

print(stats.describe(dataset_act['Percent']))
print(stats.describe(dataset_psy['Percent']))


stats.ttest_ind(dataset_act['Percent'], dataset_psy['Percent'])

"""**Results**: With a p-value that is between 0.05 and 1.96, we are unable to reject the Null hypothesis (in other words, a statistically significant difference does not exist between the percentage of growth in long-term career openings for actuaries and the percentage of growth in long-term career openings for psychiatrists).

Additionally, the distributions for the tested samples do not appear to be bell-shaped since the histogram generated by the data is dispersed in quite a scattered manner. Considering the small values for Skewness and Kurtosis, and the fact that we are working with rather small sample sizes, let's move on to the second part of this experiment:

**Method #2**: Shapiro-Wilk test

*We shall conduct a Shapiro-Wilk test in order to assess normality among these distributions.*
"""

print(stats.shapiro(dataset_act['Percent']))
print(stats.shapiro(dataset_psy['Percent']))

"""**Results**: The p-values for each of these samples of the dataset appear to be greater than 0.05, and the value of W is close to 1 in each case as well; consequently, we can therefore conclude that the populations being tested are indeed normally distributed.

Finally, given the information confirmed by the Shapiro-Wilk test, let's execute a third test to review the lack of a statistically significant result found in the first test (the T-test). 


**Method #3**:  One-way Analysis of Variance (ANOVA) test

*If there does not exist a meaningful difference between the groups in the population being tested, then it is possible to determine the likelihood of yielding a significantly large difference between the two samples by utilizing the ANOVA test:*
"""

print(stats.f_oneway(
        dataset_act['Percent'],
        dataset_psy['Percent']
      ))

import seaborn as sns

g = sns.pointplot(data=[dataset_act['Percent'],
                        dataset_psy['Percent']], join=False)
                        
g.set(xticklabels = ['Actuaries', 'Psychiatrists'], title = 'Means of Percent Long-term Career Growth in NY State')

import math

def get_95_ci(array_1, array_2):
    sample_1_n = array_1.shape[0]
    sample_2_n = array_2.shape[0]
    sample_1_mean = array_1.mean()
    sample_2_mean = array_2.mean()
    sample_1_var = array_1.var()
    sample_2_var = array_2.var()
    mean_difference = sample_2_mean - sample_1_mean
    std_err_difference = math.sqrt((sample_1_var/sample_1_n)+(sample_2_var/sample_2_n))
    margin_of_error = 1.96 * std_err_difference
    ci_lower = mean_difference - margin_of_error
    ci_upper = mean_difference + margin_of_error
    return("The difference in means at the 95% confidence interval (two-tail) is between "+str(ci_lower)+" and "+str(ci_upper)+".")

get_95_ci(dataset_act['Percent'], dataset_psy['Percent'])

# Let's take a look at current average amount of percent change for each group as well:

print(dataset_act['Percent'].mean())
print(dataset_psy['Percent'].mean())

"""**Results**: As reflected by the F-test statistic, which contains an F-score that is larger than 1 and a p-value that is greater than 0.05, the two samples are not jointly significant and moreover are unlikely to differ in the population (in effect, we are again unable to reject the Null hypothesis). In addition, after evaluating a 95% confidence interval, it is accurate to deduce the following: With 95% confidence, Psychiatrists are projected to experience between about 11.68% less and 0.75% more long-term career growth on average than Actuaries, which is a seemingly skewed difference that may account for the lack of statistically significant results throughout this experiment.

**Conclusions and Discussions**: We are unable to reject the Null hypothesis.

After analyzing the data by using the various methods employed throughout this experiment, it is reasonable to infer the following:

*   The rates at which job opportunities for Actuaries and Psychiatrists are expected to grow in the state of New York over the years ranging from 2018-2028 do not exhibit a statistically significant difference.
*   It is likely that the mean values for the distributions tested differed too greatly in order to provide a reasonable comparison between the two groups. 
*   It is possible that using another set of values, rather than those present in the Percent column, to look at and compare the data between the two groups in the tested population of the sample may yield a more efficient way of conducting the experiment.

Thank you again for your time and consideration throughout this process!
"""

!pip install plotly
!pip install ipywidgets